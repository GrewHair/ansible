- hosts: localhost
  connection: local
  become: true

  tasks:

  - name: Create the `aur_builder` user
    become: yes
    ansible.builtin.user:
      name: aur_builder
      create_home: yes
      group: wheel
  
  - name: Allow the `aur_builder` user to run `sudo pacman` without a password
    become: yes
    ansible.builtin.lineinfile:
      path: /etc/sudoers.d/11-install-aur_builder
      line: 'aur_builder ALL=(ALL) NOPASSWD: /usr/bin/pacman'
      create: yes
      validate: 'visudo -cf %s'

  - name: Install packages with Pacman
    community.general.pacman:
      name: "{{ item }}"
      state: present
    with_items:
      - neovim
      - keynav

  - name: Install AUR packages
    kewlfft.aur.aur:
      name: "{{ item }}"
    become: yes
    become_user: aur_builder
    with_items:
      - htop-vim
